/*
 1. I used the .csv files in the parent folder of this file to populate the database. Then massaged the data into normalization with lookup tables and indexes.  Some columns were dropped from national, by_state, and by_county tables to reduce redundancy.

 2. Foreign key relationships were added to by_state and by_county tables to reference state_names and church_orgs tables for data integrity.

 3. Indexes were created on frequently queried columns to optimize search performance.

 4. The models will be updated later on to reflect foreign key relationships.

 5. MongoDB schema is in a different folder

 6. Use the .csv files in this folder to populate the tables.
*/

create table public.national (
  id bigint generated by default as identity not null,
  "GroupCode" text not null,
  "Congregations" integer null,
  "Adherents" integer null,
  "Adherents_percent_of_Total_Adherents" real null,
  "Adherents_percent_of_Population" real null,
  constraint Summary_pkey primary key (id)
) TABLESPACE pg_default;


create table public.by_state (
  id bigint generated by default as identity not null,
  "StateCode" text not null,
  "GroupCode" text not null,
  "Congregations" integer null,
  "Adherents" integer null,
  "Adherents_percent_of_Total_Adherents" real null,
  "Adherents_percent_of_Population" real null,
  constraint state_pkey primary key (id),
  constraint by_state_StateCode_fkey foreign KEY ("StateCode") references state_names ("StateCode")
) TABLESPACE pg_default;
create index IF not exists statecode_bystate on public.by_state using btree ("StateCode") TABLESPACE pg_default;


create table public.by_county (
  id bigint generated by default as identity not null,
  "StateCode" text not null,
  "FIPS" integer not null,
  "GroupCode" text not null,
  "Congregations" integer null,
  "Adherents" integer null,
  "Adherents_percent_of_Total_Adherents" real null,
  "Adherents_percent_of_Population" real null,
  constraint bycounty_pkey primary key (id),
  constraint by_county_GroupCode_fkey foreign KEY ("GroupCode") references church_orgs ("GroupCode"),
  constraint by_county_StateCode_fkey foreign KEY ("StateCode") references state_names ("StateCode")
) TABLESPACE pg_default;
create index IF not exists fips_bycounty on public.by_county using btree ("FIPS") TABLESPACE pg_default;
create index IF not exists statecode_bycounty on public.by_county using btree ("StateCode") TABLESPACE pg_default;


-- a moderately sized table, about 3,200 rows
-- used to reference county names from state codes and FIPS codes
create table public.county_names (
  "StateCode" text not null,
  "CountyName" text not null,
  "FIPS" integer not null,
  constraint county_names_pkey primary key ("FIPS"),
  constraint county_names_FIPS_key unique ("FIPS"),
  constraint county_names_StateCode_fkey foreign KEY ("StateCode") references state_names ("StateCode")
) TABLESPACE pg_default;
create index IF not exists statecode_countynames on public.county_names using btree ("StateCode") TABLESPACE pg_default;
create index IF not exists fips_countynames on public.county_names using btree ("FIPS") TABLESPACE pg_default;


-- a small table, 51 rows
-- used to reference state names from state codes
create table public.state_names (
  "StateCode" text not null,
  "StateName" text not null,
  constraint stateNames_pkey primary key ("StateCode"),
  constraint stateNames_StateCode_key unique ("StateCode")
) TABLESPACE pg_default;



-- Search Queries will be ran against "GroupName" column
-- other tables will reference "GroupCode" as foreign key
create table public.church_orgs (
  "GroupName" text not null,
  "GroupCode" text not null,
  constraint church_orgs_pkey primary key ("GroupCode"),
  constraint church_orgs_GroupCode_key unique ("GroupCode"),
  constraint church_orgs_GroupName_key unique ("GroupName")
) TABLESPACE pg_default;
create index IF not exists groupcode_churchorgs on public.church_orgs using btree ("GroupCode") TABLESPACE pg_default;
create index IF not exists groupname_churchorgs on public.church_orgs using btree ("GroupName") TABLESPACE pg_default;


-- There is a problem with the metro data.  The FIPS codes do not align with distinct County names.
-- Therefore, we are not implementing the metro table at this time.  But if you want it, there it is.

-- create table public.by_metro (
--   id bigint generated by default as identity not null,
--   "CBSACode" integer null,
--   "GroupCode" text not null,
--   "GroupName" text not null,
--   "Congregations" integer null,
--   "Adherents" integer null,
--   "Adherents_percent_of_Total_Adherents" real null,
--   "Adherents_percent_of_Population" real null,
--   "MetroName" text not null,
--   constraint Metro_pkey primary key (id)
-- ) TABLESPACE pg_default;





-- The summary table was dropped because it can be hardcoded as a JSON blob.








